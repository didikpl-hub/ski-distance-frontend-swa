<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8" />
  <title>Gdzie na narty?</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 900px;
      margin: 40px auto;
      padding: 0 20px;
    }
    h1 {
      margin-bottom: 10px;
    }
    button {
      padding: 10px 16px;
      font-size: 16px;
      cursor: pointer;
      margin-right: 8px;
      margin-top: 6px;
    }
    input {
      padding: 8px;
      font-size: 16px;
      margin-right: 6px;
    }
    .resort {
      border-bottom: 1px solid #ddd;
      padding: 10px 0;
    }
    .distance {
      font-weight: bold;
    }
    .controls {
      margin-bottom: 20px;
    }
  </style>
</head>
<body>

<h1>â›·ï¸ Gdzie na narty?</h1>
<p>ZnajdÅº najbliÅ¼sze oÅ›rodki narciarskie</p>

<div class="controls">
  <div>
    ğŸ™ï¸ MiejscowoÅ›Ä‡:
    <input id="city" type="text" placeholder="np. KrakÃ³w">
    <button onclick="geocodeCity()">Ustaw lokalizacjÄ™</button>
  </div>

  <div style="margin-top:10px;">
    ğŸ“ Latitude:
    <input id="lat" type="number" step="0.00001" value="50">
    ğŸ“ Longitude:
    <input id="lon" type="number" step="0.00001" value="19">
    <button onclick="useMyLocation()">UÅ¼yj mojej lokalizacji</button>
  </div>

  <div style="margin-top:15px;">
    <button onclick="loadResorts()">PokaÅ¼ oÅ›rodki</button>
  </div>
</div>

<div id="results"></div>

<script>
async function loadResorts() {
  const lat = document.getElementById("lat").value;
  const lon = document.getElementById("lon").value;
  const results = document.getElementById("results");

  if (!lat || !lon) {
    alert("Ustaw lokalizacjÄ™ (miasto lub GPS)");
    return;
  }

  results.innerHTML = "â³ Åadowanie...";

  try {
    const response = await fetch(
      `https://ski-distance-api-ggcsccdjhpegejdg.westeurope-01.azurewebsites.net/api/ski_distance?lat=${lat}&lon=${lon}&dist_km=200`
    );

    const data = await response.json();
    results.innerHTML = "";

    if (data.error) {
      results.innerHTML = "âŒ BÅ‚Ä…d API: " + data.error;
      return;
    }

    data.forEach(r => {
      const div = document.createElement("div");
      div.className = "resort";
      div.innerHTML = `
        <h3>${r.name}</h3>
        <div>${r.city} (${r.voivodeship})</div>
        <div class="distance">ğŸ“ ${r.distance_km} km</div>
        <div>ğŸ¿ Trasy: ${r.trails_km} km</div>
        <div>ğŸ”— <a href="${r.url}" target="_blank">strona oÅ›rodka</a></div>
      `;
      results.appendChild(div);
    });

  } catch (e) {
    results.innerHTML = "âŒ BÅ‚Ä…d Å‚adowania danych";
    console.error(e);
  }
}

function useMyLocation() {
  if (!navigator.geolocation) {
    alert("Twoja przeglÄ…darka nie obsÅ‚uguje geolokalizacji");
    return;
  }

  navigator.geolocation.getCurrentPosition(
    (pos) => {
      document.getElementById("lat").value = pos.coords.latitude.toFixed(5);
      document.getElementById("lon").value = pos.coords.longitude.toFixed(5);
    },
    () => alert("Nie udaÅ‚o siÄ™ pobraÄ‡ lokalizacji")
  );
}

async function geocodeCity() {
  const city = document.getElementById("city").value;
  if (!city) {
    alert("Podaj nazwÄ™ miejscowoÅ›ci");
    return;
  }

  try {
    const res = await fetch(
      `https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(city)}`
    );
    const data = await res.json();

    if (data.length === 0) {
      alert("Nie znaleziono miejscowoÅ›ci");
      return;
    }

    document.getElementById("lat").value = parseFloat(data[0].lat).toFixed(5);
    document.getElementById("lon").value = parseFloat(data[0].lon).toFixed(5);

  } catch (e) {
    alert("BÅ‚Ä…d wyszukiwania miejscowoÅ›ci");
    console.error(e);
  }
}
</script>

</body>
</html>
